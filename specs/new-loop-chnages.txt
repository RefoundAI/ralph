R1: Implemented SQLite schema with tasks, dependencies, and task_logs tables. WAL mode, foreign key constraints, and schema versioning via user_version pragma. All unit tests passing.
R2: Implemented task ID generation (t-XXXXXX format) using SHA-256 hash of timestamp+counter. Collision retry logic with max 10 attempts. Added sha2 dependency to Cargo.toml. All unit tests passing (137 total).
R3: Implemented task hierarchy with derived parent status. Created src/dag/tasks.rs with compute_parent_status() and get_task_status() functions. Parent status computed recursively from children: failed > done > in_progress > pending. All unit tests passing (143 total).
[model-override] iteration=4 strategy_choice=opus hint=sonnet
R4: Implemented dependency management with cycle detection. Created src/dag/dependencies.rs with add_dependency() and remove_dependency(). BFS-based cycle detection rejects direct, transitive, and longer cycles. All 8 unit tests passing (151 total).
[model-override] iteration=5 strategy_choice=opus hint=sonnet
R5: Implemented ready query in get_ready_tasks(). Returns pending leaf tasks where all blockers are done and parent is not failed. Ordered by priority ASC, created_at ASC. All 7 unit tests passing (158 total).
[model-override] iteration=6 strategy_choice=opus hint=sonnet
R6: Implemented status transitions with validation and auto-transitions. Created src/dag/transitions.rs with set_task_status(), auto_unblock_tasks(), auto_complete_parent(), and auto_fail_parent(). Valid transitions enforced: pending->in_progress/blocked, in_progress->done/failed/pending, blocked->pending, failed->pending. Auto-unblock fires when blocker completes, auto-complete-parent when all children done, auto-fail-parent when child fails. Implemented claim_task(), complete_task(), fail_task(), all_resolved(), release_claim(), and get_task_counts(). All 170 unit tests passing.
[model-override] iteration=7 strategy_choice=opus hint=sonnet
R7: Implemented full CRUD API in src/dag/crud.rs. Added create_task(), get_task(), update_task() with TaskUpdate struct, delete_task() with blocker validation and cascade delete, get_task_tree() for hierarchical queries, and add_log() for task logging. Exported all functions from mod.rs. Integration test verifies complete A->B->C dependency chain with claim/complete workflow. All 188 tests passing.
[model-override] iteration=8 strategy_choice=opus hint=sonnet
R8-DAG: Database initialization already complete in src/dag/db.rs with init_db(), migration support via PRAGMA user_version, WAL mode and foreign keys enabled. All 7 unit tests passing (195 total).
R8-CLI: TOML parsing already complete in src/project.rs. ProjectConfig loads .ralph.toml with specs and prompts sections, defaults provided, discovery walks up directory tree. All 12 unit tests passing.
R1-CLI: Restructured CLI to subcommands. Removed all flags from top-level Args, added five subcommands: Init, Prompt, Run, Specs, Plan. Run subcommand has all execution flags (once, no_sandbox, limit, allow, model_strategy, model). Updated Config::from_run_args() to accept run args. Updated all tests in config.rs, strategy.rs, claude/client.rs. Bare ralph prints help. All 187 tests passing.
